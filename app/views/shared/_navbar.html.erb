<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Navbar Dropdown Example</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome (pour les icônes, si nécessaire) -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
  <!-- Styles personnalisés -->
  <style>
    .navbar-logo {
      width: 150px; /* Ajustez la taille du logo si nécessaire */
    }
    .avatar {
      width: 40px;
      border-radius: 50%;
    }
    .favorite-badge, .cart-badge {
      top: -10px;
      left: 15px;
      background-color: red;
      color: white;
    }
  </style>
</head>
<body>
  <% if user_signed_in? %>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-sm navbar-light navbar-cafe sticky-top">
    <div class="container-fluid d-flex justify-content-between align-items-center">
      <!-- Section gauche avec le logo -->
      <div class="navbar-brand">
        <%= link_to root_path(show_modal: true), id: "home-link", data: { turbo: "false" } do %> <!-- Désactive Turbo pour ce lien -->
          <%= image_tag("logo.png", alt: "Logo", class: "navbar-logo") %>
        <% end %>
      </div>

      <!-- Liens de navigation principaux au centre -->
      <div class="d-flex justify-content-center align-items-center flex-grow-1">
        <%= link_to "Accueil", root_path(show_modal: true), class: "nav-link mx-2 custom-nav-link", id: "home-link", data: { turbo: "false" } %>
        <%= link_to "Nos coups de coeur", coffees_path(sort: 'top_rated'), class: "nav-link mx-2 custom-nav-link" %>
        <%= link_to "Voir tous les cafés", coffees_path(sort: 'coffee'), class: "nav-link mx-2 custom-nav-link" %>
        <%= link_to "Contact", contact_path, class: "nav-link mx-2 custom-nav-link" %>
      </div>

      <!-- Section droite avec le coeur, le panier et le menu utilisateur -->
      <div class="d-flex align-items-center">
        <!-- Icône de coeur (favoris) -->
        <div class="nav-item mx-2 position-relative">
          <%= link_to profil_path, class: "nav-link" do %>
            <i class="fas fa-heart fa-lg"></i>
          <% end %>
          <% if current_user&.favorites&.count.to_i > 0 %>
            <span class="badge rounded-pill favorite-badge position-absolute">
              <%= current_user.favorites.count %>
              <span class="visually-hidden">Nombre de favoris</span>
            </span>
          <% end %>
        </div>

        <!-- Icône de panier -->
        <div class="nav-item mx-2 position-relative">
          <% if current_user&.cart.present? %>
            <%= link_to cart_path(current_user.cart), class: "nav-link" do %>
              <i class="fa fa-shopping-cart fa-lg"></i>
            <% end %>
          <% else %>
            <%= link_to "#", class: "nav-link disabled" do %>
              <i class="fa fa-shopping-cart fa-lg"></i>
            <% end %>
          <% end %>
          <% if current_user&.cart&.cart_items&.count.to_i > 0 %>
            <span class="badge rounded-pill cart-badge position-absolute">
              <%= current_user.cart.cart_items.count %>
              <span class="visually-hidden">Votre panier</span>
            </span>
          <% end %>
        </div>

        <!-- Menu utilisateur -->
        <div class="dropdown ms-3 me-4"> <!-- Ajout de me-4 pour la marge -->
          <a href="#" class="nav-link dropdown-toggle avatar" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <%= image_tag(current_user.photo || 'default_avatar.png', class: "avatar") %>
          </a>
          <div class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
            <%= link_to "Mon profil", profil_path, class: "dropdown-item" %>
            <%= link_to "Log out", destroy_user_session_path, data: { turbo_method: :delete }, class: "dropdown-item" %>
          </div>
        </div>
      </div>
    </div>
  </nav>
  <% end %>

  <!-- Contenu de la page -->
  <div class="page-content">
    <!-- Votre contenu de page ici -->
  </div>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Popper.js et Bootstrap JavaScript -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Script pour gérer le rechargement manuel -->
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
      // Fonction pour obtenir les paramètres de requête
      function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
      }

      // Si le paramètre "show_modal" est présent et égal à "true", afficher le modal
      if (getQueryParam('show_modal') === 'true') {
        var coffeeModal = new bootstrap.Modal(document.getElementById('coffeePreferencesModal'));
        coffeeModal.show();
      }
    });
  </script>
</body>
</html>
